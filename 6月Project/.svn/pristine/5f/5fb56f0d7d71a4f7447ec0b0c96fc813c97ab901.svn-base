<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>库位分布图</title>
    <style>
    *{margin:0;padding:0;}
    body{text-align:center;background-color:#000;}
    </style>
</head>
<script src='base.js' lang="utf-8"></script>
<body><div id="info"/>
    <canvas id="canvas" width="700" height="500" style="background:#000;"></canvas>
     <button id="fullScreenBtn">全屏</button>
    <script>
      resList=[];
    globalX=0;
    globalY=0; 
    function myDraw(context){
    
    	    context.strokeStyle= 'rgba(0,0,0,0.1)'
    		  context.font=" 15px 宋体";
    		  storeRoom.draw();
    			var tulix=200;
          tuli(context,tulix,"入库中",'#aaaaff');
          tulix+=150
      		tuli(context,tulix,"库存",'#1111ff');
      		tulix+=150
      		tuli(context,tulix,"出库中",'#6666c4');
      		
	    		if(resList&&resList.length>0){
	        	for(var i=0;i<resList.length;i++){
	        		var d = resList[i];
	        		addStockProduct(context,storeRoom,d.l,d.t,d.s)  
	        	}
	        }
    } 
    
    
    function tuli(context,tuliy,info,color){
    	    tuliy/=2.5
    			var tulix=1010;
    			var tuli = new   Rectangle(context,tulix,tuliy,tulix+80,tuliy+20,0.5,color);
      		tuli.draw();  
      		context.fillStyle='#000000'
      		context.fillText(info,tulix,tuliy+35);
    	
    	}
    
    
    function addStockProduct(context,storeRoom,id,widthType,status){
     	  	var w=9;
     	  	var color="ffffff";
     	  	if(widthType==2){
     	  		w=storeRoom.storeWidth/9
     	  		 if(status==1){
     	  			color="#8c8cff";
     	  		} else if(status==2){
     	  			color="#1111ff";
     	  		}else if(status==3){
     	  			color="#6666c4";
     	  			}
     	  	}else if(widthType==1){
     	  		w=storeRoom.storeWidth/11
     	  		 if(status==1){
     	  			color="#ffffcc";
     	  		} else if(status==2){
     	  			color="#ffff00";
     	  		}else if(status==3){
     	  			color="#ffff66";
     	  		}
     	  	}
     	  	var  key=parseInt(id/100)
     	    var  index=id%100
     	  	var stock = new StockProduct(context,color);
     	  	var store = storeRoom.stores['k'+key];
     	  	var anchor = store.getAnchor();
     	  	
     	  	var newAnchor={x:store.x1+parseInt(w*(index-0.5)),y:anchor.y}
     	  	
     	  	stock.setAnchor(newAnchor)
     	  	stock.draw();
     	  }
    
    
        
    window.onload = function(){
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        canvas.height= window.screen.height 
        canvas.width= window.screen.width 
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.fillStyle="#1ff";
        context.fillRect(0,0,canvas.width,canvas.height);
        context.translate(0.5,0.5);
        
       
        storeRoom = new  StoreRoom(context,14+globalX,5+globalY,{shelfs:6,beginShelf:16,rows:10});
        
        //动画循环
	        (function drawFrame(){
	            window.requestAnimationFrame(drawFrame);
	            context.clearRect(0, 0, canvas.width, canvas.height);
	            context.fillStyle="#1ff";
	            context.fillRect(0,0,canvas.width,canvas.height);
	            myDraw(context);
	        }());
	        
	       
	         	/*
        	getAjaxFun("http://192.168.111.100:4830/api/dp/d",function(val){
	        	resList = val.data;
			    })
			    */ 
	        
	        
        
		}
    </script>
</body>

<script src='Fullscreen.js' lang="utf-8"></script>
<script src='component.js' lang="utf-8"></script>
<script src='myAjax.js' lang="utf-8"></script>
</html>




