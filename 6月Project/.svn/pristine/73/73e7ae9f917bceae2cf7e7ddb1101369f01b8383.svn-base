
using GK.Common;
using GK.WMS.DAL;

using GK.WMS.Entity;
using HY.WCS.DAL;
using HY.WCS.DAL.dto;
using HY.WCS.Entity.dto;
using System;
using System.Collections.Generic;
using System.Security.Cryptography;
using System.Text;
using System.Web;


using System.Web.Http;
using System.Web.Http.Cors;
using Web.Authorize;

namespace WebApi
{
    [FormAuthenticationFilter]

    [RoutePrefix("api/users")]
    public class UsersController : BaseApiController
    {


        ISysAuthorityServer authorityServer = WMSDalFactray.getDal<ISysAuthorityServer>();
        ISequenceIdServer sequenceIdServer = WMSDalFactray.getDal<ISequenceIdServer>();

        [HttpGet, Route("info")]
        public BaseResult info()
        {
            String data = " 0";



            return new BaseResult("admin");
        }



        [HttpGet, Route("GetUserlist")]
        public BaseResult GetUserlist(String listQuery)
        {
            UserDto userDto = Newtonsoft.Json.JsonConvert.DeserializeObject<UserDto>(listQuery);
            var info = authorityServer.queryUserPage<SysUser>(userDto);
            return new BaseResult(info.list, info.count);
        }


        [HttpPut, Route("UpdateUser")]
        public BaseResult UpdateUser([FromBody]SysUser user)
        {
            user.password = GKMD5.MD5Encrypt(user.password);
            return new BaseResult(authorityServer.updateUser(user));
        }

        [HttpPost, Route("AddUser")]
        public BaseResult AddUser([FromBody]SysUser user)
        {
            user.id = sequenceIdServer.getId();
            user.password = GKMD5.MD5Encrypt(user.password);
            return new BaseResult(authorityServer.addUser(user));
        }

        [HttpDelete, Route("DeleteUser/{id}")]
        public BaseResult DeleteUser(string id)
        {
            return new BaseResult(authorityServer.deleteUser(id));
        }
    }
}